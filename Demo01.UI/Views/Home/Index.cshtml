
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    //int Count = Convert.ToInt32(ViewData["Count"]);
    List<Demo01.Model.Data.ProductCategory> type = ViewData["type"] as List<Demo01.Model.Data.ProductCategory>;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>3C数码商城</title>
    <style>
        #page {
            height: 200px;
            margin: 0 auto;
        }

        .point {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="right">
        <select class="form-control" id="ty">
            <option selected="selected" value="0">全部</option>
            @foreach (var item in type)
            {
                <option value="@item.Id">@item.Name</option>
            }
        </select>
        <table id="page" class="table table-hover text-center">
            @*分页标签*@
        </table>
        <div id="choose">
            <p id="pag"></p>@*页数标签*@
        </div>
    </div>
    <!--模态框-->
    <div>
        <!-- 模态框（Modal） -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">修改</h4>
                    </div>
                    <div class="modal-body">
                        <div>
                            <label data-id="" id="lab">商品名称</label>
                            <input id="name" class="form-control" type="text" value="" />
                        </div>
                        <div>
                            <label>市场价格</label>
                            <input id="price" class="form-control" type="text" value="" />
                        </div>
                        <div>
                            <label>商品售价</label>
                            <input id="Sprice" class="form-control" type="text" value="" />
                        </div>
                        <div>
                            <label>商品介绍</label>
                            <input id="Det" class="form-control" type="text" value="" />
                        </div>
                        <div>
                            <label>商品类别</label>
                            <select class="form-control" id="type">
                                @foreach (var item in type)
                                {
                                    <option value="@item.Id">@item.Name</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" id="Upd" class="btn btn-success">提交更改</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->

        </div>
    </div>
    <script src="~/Scripts/jquery-3.3.1.js"></script>
    <script type="text/javascript">
        $(function () {
            var ind = 0;//页数
            var SID = 0;//类别
            var num;//类别id
            band(1, 0)
            coun(SID)
            MenuClick()
            //返回首页（刷新）
            $(".text").click(function () {
                $.ajax({
                    url: "/home/band",
                    type: "post",
                    dataType: "json",
                    success: function (res) {
                        console.log(res)
                        if (res == 0) {
                            location.reload();
                        }

                    }
                });
            });
            //页数绑定
            function coun(SID) {
                $.ajax({
                    url: "/home/Count",
                    dataType: "json",
                    data: { SID: SID },
                    type: "post",
                    success: function (res) {
                        num = res
                        if (res != 0) {
                            $("#pag a").remove();
                            for (var i = 0; i < res; i++) {
                                $("#pag").append("<a class='but btn'>" + (i + 1) + "</a>");
                            }
                            $(".but").click(function () {
                                band($(this).text(), SID)
                                ind = $(this).text();
                            });
                        }
                    }
                });
            };
            //菜单点击事件
            function MenuClick() {
                $(".Firstmenu li a").click(function (event) {
                    SID = $(this).attr("data-id")
                    coun(SID)
                    if (num != 0) {
                        band(1, SID)
                    } else {
                        switch ($(this).text()) {
                            case "查看商品":
                                band(1, 0)
                                break;
                            case "新增商品":
                                $("#Upd").text("添加商品")
                                $("#Upd").attr("id", "Ins")
                                $('#myModal').modal('show')
                                $("#Ins").click(function () {
                                    Upd(0)
                                });
                                break;
                        }
                    }
                    event.stopPropagation();
                });
            }
            //分页
            function band(id, SID) {
                $.ajax({
                    url: "/home/Page",
                    data: { ID: id, SID: SID },
                    dataType: "json",
                    type: "post",
                    //分页绑定
                    success: function (res) {
                        if (res != null) {
                            $("#page tr").remove();
                            $("#page").append("<tr style='font-size:20px;'><td>商品名称</td><td>市场价格</td><td>商品售价</td><td>产品介绍</td><td>商品类别</td><td>操作</td></tr>");
                            for (var i = 0; i < res.length; i++) {
                                $("#page").append("<tr><td>"
                                    + res[i]["pro"].ProductName +
                                    "</td><td>"
                                    + res[i]["pro"].SellingPrice +
                                    "</td><td>"
                                    + res[i]["pro"].MarketPrice +
                                    "</td><td>"
                                    + res[i]["pro"].Introduction +
                                    "</td><td>"
                                    + res[i].Name +
                                    "</td><td><input data-id="
                                    + res[i]["pro"].Id +
                                    " class='button' type='button' value='修改'><input data-id="
                                    + res[i]["pro"].Id +
                                    " class='Del' type='button' value='删除'></td></tr>");
                            }
                            //删除事件
                            $(".Del").click(function () {
                                $.ajax({
                                    url: "/home/Del",
                                    data: { Id: $(this).attr("data-id") },
                                    dataType: "json",
                                    type: "post",
                                    success: function (res) {
                                        if (res) {
                                            if (ind == 0) {
                                                band(1, SID)
                                                coun(SID)
                                            } else {
                                                coun(SID)
                                                band(ind, SID)
                                            }

                                        }
                                    }
                                });
                            });
                            //模态框赋值
                            $(".button").click(function () {
                                $('#myModal').modal('show')
                                $.ajax({
                                    url: "/home/Sel",
                                    data: { Id: $(this).attr("data-id") },
                                    dataType: "json",
                                    type: "post",
                                    success: function (res) {
                                        console.log(res);
                                        if (res != null) {
                                            $("#lab").attr("data-id", res["pro"].Id);
                                            $("#name").val(res["pro"].ProductName)
                                            $("#price").val(res["pro"].SellingPrice)
                                            $("#Sprice").val(res["pro"].MarketPrice)
                                            $("#Det").val(res["pro"].Introduction)
                                            $("#type").find("option").eq(res["pro"].CategoryId - 1).prop("selected", true)
                                        }
                                    }
                                });
                            });
                        }
                    }
                });

            }
            //更新函数
            function Upd(TID) {
                $.ajax({
                    url: "/home/Upd",
                    data: {
                        tid: TID,
                        name: $("#name").val(),
                        price: $("#price").val(),
                        sprice: $("#Sprice").val(),
                        det: $("#Det").val(),
                        ty: $("#type").find("option:selected").val()
                    },
                    dataType: "json",
                    type: "post",
                    success: function (res) {
                        if (res) {
                            $('#myModal').modal('hide')
                            if (ind == 0) {
                                band(1, SID)
                                coun(SID)
                            } else {
                                coun(SID)
                                band(ind, SID)
                            }
                        }
                    }
                });
            }
            //点击执行
            $("#Upd").click(function () {
                $("#Upd").text("提交更改")
                Upd($("#lab").attr("data-id"));
            });
            $("#ty").change(function () {
                SID = $(this).val()
                coun(SID)
                band(1, SID)
            });
        });
    </script>
</body>
</html>



